(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66aed930"],{"0126":function(t,e,i){},"08f3":function(t,e,i){"use strict";var n=i("d912"),o=i.n(n);o.a},"0a6d":function(t,e,i){"use strict";var n=i("922c"),o=i.n(n);o.a},1171:function(t,e,i){},1816:function(t,e,i){"use strict";var n=i("1171"),o=i.n(n);o.a},"1b5b":function(t,e,i){},"29fb":function(t,e,i){},"616c":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",[i("aside-index",{attrs:{indexList:t.indexList,activeArticle:t.activeArticle},on:{indexClick:t.handleIndexClick}}),i("el-main",{ref:"el-main"},[i("div",{ref:"scroll-main",staticClass:"wrapper",on:{scroll:t.handleOnScroll}},[i("project-info",{attrs:{projectInfo:t.projectInfo},on:{"update:projectInfo":function(e){t.projectInfo=e},"update:project-info":function(e){t.projectInfo=e}}}),t._l(t.articles,(function(e){return i("project-article",{key:e.id,attrs:{projectInfo:t.projectInfo,articleInfo:e}})})),i("new-article",{attrs:{projectInfo:t.projectInfo},on:{addNewArticleSuccess:t.addNewArticle}})],2)])],1)},o=[],r=(i("9957"),i("4634"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-aside",{attrs:{width:t.barWidth+"px"}},[i("ul",{staticClass:"wrapper"},[i("div",{staticClass:"active",style:{transform:"translateY("+t.activeTop+"px)"}}),t._l(t.indexList,(function(e,n){return i("li",{key:e._id,on:{click:function(e){return t.handleIndexClick(n)}}},[t._v(t._s(n+1)+". "+t._s(e.title))])}))],2)])}),a=[],c=(i("e6d1"),{data:function(){return{barWidth:250,hide:!1,activeTop:0}},props:["indexList","activeArticle"],mounted:function(){document.body.clientWidth<500&&(this.barWidth=0,this.hide=!0)},watch:{activeArticle:function(t){var e=this;this.indexList.some((function(i,n){if(i._id===t.split("_")[1])return e.activeTop=44*n,!0}))}},methods:{handleIndexClick:function(t){var e=this.indexList[t]._id;this.activeTop=44*t,this.$emit("indexClick",e)}}}),s=c,l=(i("fc20"),i("6691")),d=Object(l["a"])(s,r,a,!1,null,"20034925",null),u=d.exports,f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"article",attrs:{id:"article_"+t.articleInfo._id}},[i("div",{staticClass:"article-title"},[i("span",[t._v(t._s(t.articleInfo.title))]),i("div",{staticClass:"button-wrapper"},[i("el-button",{attrs:{icon:"el-icon-edit",size:"mini",circle:""},on:{click:function(e){t.editorShow=!t.editorShow}}}),i("el-button",{attrs:{type:"info",icon:"el-icon-delete",size:"mini",circle:""},on:{click:t.handleDeleteClick}})],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.editorShow,expression:"!editorShow"}],staticClass:"article-content",domProps:{innerHTML:t._s(t.articleInfo.html)}}),i("div",{staticClass:"editor-wrapper"},[t.editorShow?i("article-editor",{attrs:{boxShadow:!1,articleInfo:t.articleInfo,projectInfo:t.projectInfo}}):t._e()],1)])},h=[],p=function(){var t=this,e=this,i=e.$createElement,n=e._self._c||i;return n("div",{staticClass:"article-editor"},[n("div",{class:{title:!0,"title-active":""!==e.title}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.title,expression:"title"}],staticClass:"title-input",attrs:{type:"text",placeholder:"请输入标题"},domProps:{value:e.title},on:{input:function(t){t.target.composing||(e.title=t.target.value)}}})]),n("mavon-editor",{attrs:{boxShadow:e.boxShadow},on:{change:function(e,i){return t.html=i}},model:{value:e.md,callback:function(t){e.md=t},expression:"md"}}),n("div",{staticClass:"button-wrapper"},[n("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("提交")]),n("el-button",{attrs:{type:"danger"},on:{click:e.handleCancel}},[e._v("取消")])],1)],1)},m=[],v={name:"article-editor",data:function(){return{editMode:"new",md:"",html:"",title:""}},props:{articleInfo:{type:Object,default:function(){return{}}},projectInfo:{type:Object,required:!0},boxShadow:{type:Boolean,default:!0}},methods:{init:function(){this.articleInfo._id&&(this.md=this.articleInfo.md,this.html=this.articleInfo.html,this.editMode="modify")},_editorClear:function(){this.md="",this.html="",this.title=""},handleSubmit:function(){if(""!==this._.trim(this.md)&&""!==this._.trim(this.title))switch(this.editMode){case"new":this.$emit("new",{pid:this.projectInfo._id,title:this.title,md:this.md,html:this.html});break;case"modify":this.$emit("modify",{pid:this.projectInfo._id,title:this.title,md:this.md,html:this.html,aid:this.articleInfo._id});break}else this.$message.error("请填写完整内容!")},handleCancel:function(){this.$emit("cancel")}},mounted:function(){this.init()}},w=v,b=(i("9869"),Object(l["a"])(w,p,m,!1,null,"6a460909",null)),I=b.exports,_={data:function(){return{editorShow:!1}},props:["projectInfo","articleInfo"],components:{ArticleEditor:I},methods:{handleDeleteClick:function(){var t=this;this.$confirm("此操作将永久删除该文段, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$message({type:"success",message:"删除成功!"}),t.handleDelete(t.articleInfo._id)})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handleDelete:function(t){console.log(t)}}},j=_,g=(i("8b9c"),i("08f3"),Object(l["a"])(j,f,h,!1,null,"28ef2554",null)),C=g.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"projectInfo",attrs:{id:"projectInfo"}},[i("h1",{staticClass:"projectName"},[i("div",{staticClass:"left"},[t._v("\n      "+t._s(t.projectInfo.projectName)+"\n      "),i("el-button",{attrs:{round:"",type:t.editMode?"info":"default",size:"small"},on:{click:function(e){t.editMode=!t.editMode}}},[t._v(t._s(t.editMode?"取消编辑":"编辑此段"))])],1),i("i",{staticClass:"el-icon-info right",on:{click:function(e){e.stopPropagation(),t.showContributor=!t.showContributor}}})]),i("transition",{attrs:{name:"fade-down"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showContributor,expression:"showContributor"}],staticClass:"info-card"},[i("ul",[i("li",{staticClass:"creator"},[i("img",{attrs:{src:t.projectInfo.creator?t.projectInfo.creator.avatar:""}}),i("div",{staticClass:"name"},[t._v("\n            "+t._s(t.projectInfo.creator?t.projectInfo.creator.name:"")+"\n            "),i("span",[t._v("创建者")])])]),t._l(t.projectInfo.partners,(function(e){return i("li",{key:e.id,staticClass:"partner"},[i("img",{attrs:{src:e.avatar}}),i("div",{staticClass:"name"},[t._v(t._s(e.name))])])}))],2)])]),t.editMode?t._e():i("p",{staticClass:"desc",domProps:{innerHTML:t._s(t.projectInfo.desc)}}),t.editMode?i("div",{staticClass:"editor"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editorContent,expression:"editorContent"}],attrs:{name:"info-editor",id:"info-editor",rows:"8"},domProps:{value:t.editorContent},on:{input:function(e){e.target.composing||(t.editorContent=e.target.value)}}}),i("div",{staticClass:"btn-wrapper"},[i("el-button",{attrs:{type:"success",size:"small"},on:{click:t.handleSubmit}},[t._v("提交")])],1)]):t._e()],1)},S=[];i("c041");function k(t,e){for(var i=t.split(e),n=0;n<i.length;n++)""===i[n]&&n!=i.length-1&&(i.splice(n,1),n--);return i.join(e)}var A={data:function(){return{showContributor:!1,editMode:!1,editorContent:""}},props:["projectInfo"],methods:{handleSubmit:function(){var t=this,e=this.editorContent;e=k(e,"\n"),e=this._.escape(e).replace(/\n/g,"</p><p>"),this.axios.post("/project/modifyProjectInfo",{_id:this.projectInfo._id,desc:e}).then((function(e){t.$message.success("修改成功"),t.$emit("update:projectInfo",e.data.data),t.editMode=!1})).catch((function(e){console.log(e),t.$message.error("".concat(e))}))}},mounted:function(){var t=this;window.addEventListener("click",(function(){t.showContributor=!1}))},watch:{editMode:function(){this.editorContent=this._.unescape(this.projectInfo.desc),this.editorContent=this.editorContent.replace(/<\/p><p>/g,"\n\n")}}},$=A,y=(i("0a6d"),Object(l["a"])($,x,S,!1,null,"1e2d129f",null)),T=y.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"new-article"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.editorShow,expression:"!editorShow"}],staticClass:"add",on:{click:function(e){t.editorShow=!0}}},[i("i",{staticClass:"el-icon-document-add"}),t._v(" 新增\n  ")]),i("article-editor",{directives:[{name:"show",rawName:"v-show",value:t.editorShow,expression:"editorShow"}],attrs:{projectInfo:t.projectInfo},on:{new:t.handleNewProject,cancel:t.handleCancel}})],1)},N=[],P={name:"new-article",data:function(){return{editorShow:!1}},props:["projectInfo"],components:{ArticleEditor:I},methods:{handleNewProject:function(t){var e=this;console.log(t),this.axios.post("/project/addArticle",{pid:t.pid,title:t.title,md:t.md,html:t.html}).then((function(t){e.$emit("addNewArticleSuccess",t.data.data),e.$message.success("发布成功！"),e.$children[0]._editorClear()})).catch((function(t){console.log(t),e.$message.error("".concat(t))}))},handleCancel:function(){this.editorShow=!1}}},E=P,L=(i("f8d65"),Object(l["a"])(E,M,N,!1,null,"7998ea06",null)),O=L.exports,D={name:"project",components:{AsideIndex:u,ProjectArticle:C,ProjectInfo:T,NewArticle:O},data:function(){return this.timmer=null,this.AnimationTimmer=null,{projectInfo:{},articles:[],activeArticle:""}},props:["pid"],computed:{indexList:function(){var t=[];return this.articles.forEach((function(e){if(e._id){var i=e._id,n=e.title,o={_id:i,title:n};t.push(o)}})),t}},methods:{getProjectData:function(){var t=this;this.axios.get("/project/getProjectByPid?pid=".concat(this.pid)).then((function(e){var i=e.data.data;t.articles=i.articles,delete i.articles,t.projectInfo=i})).catch((function(e){console.log(e),t.$message.error("".concat(e))}))},handleOnScroll:function(){var t=this;null!=this.timmer&&clearTimeout(this.timmer),this.timmer=setTimeout((function(){var e=t.$refs["scroll-main"].scrollTop,i=document.querySelectorAll(".article");[].some.call(i,(function(i){var n=i.offsetTop+i.clientHeight-e-60;if(n>50){var o=i.getAttribute("id");return t.activeArticle!=o&&(t.activeArticle=o),!0}}))}),100)},handleIndexClick:function(t){var e=this;this.AnimationTimmer&&clearInterval(this.AnimationTimmer);var i=document.querySelector("#article_".concat(t)),n=i.offsetTop-60,o=this.$refs["scroll-main"],r=o.scrollTop,a=Math.abs(r-n),c=Math.sign(n-r),s=a/100,l=o.scrollTop-1;this.AnimationTimmer=setInterval((function(){var t=o.scrollTop;if(l!==t)switch(l=t,o.scrollTop+=s*c,c){case-1:t-s<n&&(clearInterval(e.AnimationTimmer),o.scrollTop=n);break;case 1:t+s>n&&(clearInterval(e.AnimationTimmer),o.scrollTop=n);break;case 0:clearInterval(e.AnimationTimmer);break}else clearInterval(e.AnimationTimmer)}),1)},addNewArticle:function(t){this.articles.push(t)}},mounted:function(){this.getProjectData()}},z=D,B=(i("1816"),Object(l["a"])(z,n,o,!1,null,"b461e748",null));e["default"]=B.exports},"8b9c":function(t,e,i){"use strict";var n=i("29fb"),o=i.n(n);o.a},"922c":function(t,e,i){},9869:function(t,e,i){"use strict";var n=i("1b5b"),o=i.n(n);o.a},9957:function(t,e,i){var n=i("2498");n(n.S,"Math",{sign:i("aa38")})},aa38:function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},bc8b:function(t,e,i){},c041:function(t,e,i){"use strict";var n=i("8cac"),o=i("a9cf"),r=i("8941"),a=i("a6ad"),c=i("ff04"),s=i("2137"),l=Math.max,d=Math.min,u=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,h=/\$([$&`']|\d\d?)/g,p=function(t){return void 0===t?t:String(t)};i("6af6")("replace",2,(function(t,e,i,m){return[function(n,o){var r=t(this),a=void 0==n?void 0:n[e];return void 0!==a?a.call(n,r,o):i.call(String(r),n,o)},function(t,e){var o=m(i,t,this,e);if(o.done)return o.value;var u=n(t),f=String(this),h="function"===typeof e;h||(e=String(e));var w=u.global;if(w){var b=u.unicode;u.lastIndex=0}var I=[];while(1){var _=s(u,f);if(null===_)break;if(I.push(_),!w)break;var j=String(_[0]);""===j&&(u.lastIndex=c(f,r(u.lastIndex),b))}for(var g="",C=0,x=0;x<I.length;x++){_=I[x];for(var S=String(_[0]),k=l(d(a(_.index),f.length),0),A=[],$=1;$<_.length;$++)A.push(p(_[$]));var y=_.groups;if(h){var T=[S].concat(A,k,f);void 0!==y&&T.push(y);var M=String(e.apply(void 0,T))}else M=v(S,f,k,A,y,e);k>=C&&(g+=f.slice(C,k)+M,C=k+S.length)}return g+f.slice(C)}];function v(t,e,n,r,a,c){var s=n+t.length,l=r.length,d=h;return void 0!==a&&(a=o(a),d=f),i.call(c,d,(function(i,o){var c;switch(o.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,n);case"'":return e.slice(s);case"<":c=a[o.slice(1,-1)];break;default:var d=+o;if(0===d)return i;if(d>l){var f=u(d/10);return 0===f?i:f<=l?void 0===r[f-1]?o.charAt(1):r[f-1]+o.charAt(1):i}c=r[d-1]}return void 0===c?"":c}))}}))},d912:function(t,e,i){},f8d65:function(t,e,i){"use strict";var n=i("0126"),o=i.n(n);o.a},fc20:function(t,e,i){"use strict";var n=i("bc8b"),o=i.n(n);o.a}}]);
//# sourceMappingURL=chunk-66aed930.bb5149a0.js.map